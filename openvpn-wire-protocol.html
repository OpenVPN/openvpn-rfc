<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OpenVPN Wire Protocol</title>
<meta content="Arne Schwabe" name="author">
<meta content="David Sommerseth" name="author">
<meta content="Steffan Karger" name="author">
<meta content="
       
        OpenVPN is an open source SSL/TLS based VPN solution which had
        its first release in May 2001.  This document describes the wire
        protocol OpenVPN makes use of for establishing end-to-end-
        connections.  Even though OpenVPN bases its communication on
        SSL/TLS, it is not a traditional SSL/TLS protocol which utilizes
        only TCP.  OpenVPN supports some enhanced security features as
        well as providing SSL/TLS connections both over TCP as well as
        UDP.

        This document focuses on the modern/current variant of the OpenVPN
        protocol. Some of the features used in older variants of the protocol
        are not documented.
       
    " name="description">
<meta content="xml2rfc 3.11.1" name="generator">
<meta content="OpenVPN" name="keyword">
<meta content="protocol" name="keyword">
<meta content="VPN" name="keyword">
<meta content="draft-openvpntech-openvpn-wire-protocol-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.11.1
    Python 3.9.9
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycairo 1.20.1
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 59.0.1
    six 1.15.0
-->
<link href="openvpn-wire-protocol.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OpenVPN Wire Protocol</td>
<td class="right">January 2038</td>
</tr></thead>
<tfoot><tr>
<td class="left">Schwabe, et al.</td>
<td class="center">Expires 23 July 2038</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-openvpntech-openvpn-wire-protocol-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2038-01-19" class="published">19 January 2038</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2038-07-23">23 July 2038</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A.S. Schwabe</div>
<div class="org">OpenVPN, Inc</div>
</div>
<div class="author">
      <div class="author-name">D.S. Sommerseth</div>
<div class="org">OpenVPN, Inc</div>
</div>
<div class="author">
      <div class="author-name">S.K. Karger</div>
<div class="org">Fox-IT</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OpenVPN Wire Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
        OpenVPN is an open source SSL/TLS based VPN solution which had
        its first release in May 2001.  This document describes the wire
        protocol OpenVPN makes use of for establishing end-to-end-
        connections.  Even though OpenVPN bases its communication on
        SSL/TLS, it is not a traditional SSL/TLS protocol which utilizes
        only TCP.  OpenVPN supports some enhanced security features as
        well as providing SSL/TLS connections both over TCP as well as
        UDP.

        This document focuses on the modern/current variant of the OpenVPN
        protocol. Some of the features used in older variants of the protocol
        are not documented.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 23 July 2038.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2038 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-the-openvpn-wire-protocol" class="xref">The OpenVPN Wire Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-tcp-and-udp-transport-modes" class="xref">TCP and UDP transport modes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-static-key-mode-and-tls-ope" class="xref">Static-key mode and TLS operational modes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-hmac-authentication-of-cont" class="xref">HMAC authentication of control channel packets</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-encrypting-control-channel-" class="xref">Encrypting control channel packets</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-control-channel-packet-encr" class="xref">Control channel packet encryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-tls-crypt-security-consider" class="xref">tls-crypt Security considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-client-specific-tls-crypt-k" class="xref">Client-specific tls-crypt keys (tls-crypt-v2)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-packet-replay-protection" class="xref">Packet replay protection</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-pushing-configuration-optio" class="xref">Pushing configuration options and OCC</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-openvpn-key" class="xref">OpenVPN Key</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-communictaion-channels" class="xref">Communictaion channels</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-overview-of-opcodes" class="xref">Overview of OPCODEs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-the-control-channel" class="xref">The Control Channel</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-the-data-channel" class="xref">The Data Channel</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-aead-encrypted-data-channel" class="xref">AEAD encrypted data channel packet</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.  <a href="#name-cbc-ofb-ctr-encrypted-packe" class="xref">CBC/OFB/CTR encrypted packet</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.  <a href="#name-packet-id" class="xref">Packet ID</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-peer-id" class="xref">Peer-ID</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-requirements" class="xref">Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-allowing-floating-clients" class="xref">Allowing floating clients</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-control-channel-messages" class="xref">Control channel messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-message-format" class="xref">Message format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-push_request" class="xref">PUSH_REQUEST</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-push_reply" class="xref">PUSH_REPLY</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-auth_pending" class="xref">AUTH_PENDING</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.  <a href="#name-restart-and-halt" class="xref">RESTART and HALT</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="xref">9.6</a>.  <a href="#name-auth_failed" class="xref">AUTH_FAILED</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="xref">9.7</a>.  <a href="#name-cr_response" class="xref">CR_RESPONSE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="xref">9.8</a>.  <a href="#name-info_pre-and-info" class="xref">INFO_PRE and INFO</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-cryptography" class="xref">Cryptography</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-openvpn-and-the-ssl-tls-pro" class="xref">OpenVPN and the SSL/TLS protocol</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-cipher-negotiation" class="xref">Cipher negotiation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-tls-mode-and-pki" class="xref">TLS mode and PKI</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-user-authentication" class="xref">User authentication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-user-password-authenticatio" class="xref">User/password authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-challenge-response-authenti" class="xref">Challenge-Response authentication</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
        OpenVPN is an open source SSL/TLS based VPN soltion which was
        first released in 2001.  The communication between OpenVPN
        instances are based on SSL/TLS but it has added several
        additional features on top of the standard SSL/TLS protocol.
        The wire protocol this document describes will go into the
        depths of how OpenVPN processes communicates with each other.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
        The wire protocol is dynamic, which means it will be slightly
        different depending on which features the OpenVPN processes have
        been configured to use.  New implementations SHOULD implement all
        features.<a href="#section-1-2" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <span><a href="#RFC2119" class="xref">RFC 2119</a> [<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-the-openvpn-wire-protocol">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-the-openvpn-wire-protocol" class="section-name selfRef">The OpenVPN Wire Protocol</a>
      </h2>
<p id="section-2-1">
        Since OpenVPN can work both in a traditional server-client setup
        as well as a peer-to-peer setup, this document tries to avoid the
        concept of server and clients.  It will be refered to these as
        either the local or remote sites. In a peer-to-peer setup only
        a single tunnel can be established, while in a server-client setup
        several clients can connect to a single server at the same time.

        If the terms server and client are used these are almost always
        synonymous with the peer's role as either TLS server or TLS client.<a href="#section-2-1" class="pilcrow">¶</a></p>
<section id="section-2.1">
        <h3 id="name-tcp-and-udp-transport-modes">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-tcp-and-udp-transport-modes" class="section-name selfRef">TCP and UDP transport modes</a>
        </h3>
<p id="section-2.1-1">
          OpenVPN is capable of using both UDP and TCP for transporting
          SSL/TLS traffic.  The SSL/TLS protocol is strictly written for
          TCP but OpenVPN makes that possible through encapsulating the
          SSL/TLS packets and adding a reliability layer to avoid issues
          when packets gets resent.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">
          The wire packet identical for both transport modes with one
          exception.  For UDP packets the size of a payload packet is
          derived from UDP packet length. Since TCP present a stream
          of bytes to the application, TCP payloads carry a 16 bits
          packet length indicator of the size of the payload.
          Splitting too large payload and combining multiple payload
          into packets is done by the TCP/IP of the operating system.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-2.2">
        <h3 id="name-static-key-mode-and-tls-ope">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-static-key-mode-and-tls-ope" class="section-name selfRef">Static-key mode and TLS operational modes</a>
        </h3>
<section id="section-2.2.1">
          <h4 id="name-static-key-mode">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-static-key-mode" class="section-name selfRef">Static-key mode</a>
          </h4>
<p id="section-2.2.1-1">
          The OpenVPN protocol has a mode where it does not use
          dynamic key derivation but instead uses static keys. 
          The mode does not make use of any TLS features, so
          and is called static key mode.  In this mode there is no control
          channel and all the data on the wire is plain encrypted packets
          transported over a standard UDP or TCP connection.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.1-2">
          Peer-to-peer mode also depends on a shared secret key between
          both ends of the VPN tunnel.  Again, as there are no SSL/TLS
          handshakes between either side, this method does not have any
          possibilties to enable Perfect Forward Secrecy (PFS).  The
          data channel is encrypted solely by the shared static secret.
          This mode does not negotiate any ephemeral session keys for the
          tunnelled data.

          Using pre-shared significantly also weakens the guarantees for
          no IV reuse, so modern ciphers like AES in GCM mode are not
          avaiable in this mode

          This mode is deprecated and this document does not provide
          documentation for it.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-2.2.2">
          <h4 id="name-tls-mode">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-tls-mode" class="section-name selfRef">TLS mode</a>
          </h4>
<p id="section-2.2.2-1">
          With TLS mode the control channel gets activated and this
          requires both sides to make use of private keys and
          <span><a href="#RFC5280" class="xref">X.509</a> [<a href="#RFC5280" class="xref">RFC5280</a>]</span> Certificates.  These requirements are due to this
          operational mode utilizing the  <span><a href="#RFC5246" class="xref">TLS/SSL</a> [<a href="#RFC5246" class="xref">RFC5246</a>]</span> protocol
          This mode is also the only operational mode which uses the
          client-server terminology in OpenVPN.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">
          The use of X.509 certificates on the client side is OPTIONAL
          and it is REQUIRED on the server side.  It is highly
          RECOMMENDED to always enable user/password authentication when X.509
          client certificates is not used.<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.2-3">
          It is highly RECOMMENDED to enforce certificate authentication
          against a locally controlled Certificate Authority (CA) certificate.
          The use of public Certification Authorities will reduce the security
          of the tunnel dramatically, as it can easily enable man-in-the-middle
          attacks where the client cannot verify the true identity of a server,
          or a server cannot verify the true identity of a client.<a href="#section-2.2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2.2-4">
          [FIXME/syzzer: explain more what happens on the wire during the
                  SSL/TLS handshake and certificate authentication]<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2.2-5">
          The TLS mode will use the same communication channel for
          both TLS handshakes and the tunnel data.  The TLS handshakes
          is referred to as the control channel and tunnel data is
          referred to as the data channel.  Each packet in TLS mode,
          contains an OPCODE which defines if the following payload is
          a control channel or data channel packet.<a href="#section-2.2.2-5" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2.3">
        <h3 id="name-hmac-authentication-of-cont">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-hmac-authentication-of-cont" class="section-name selfRef">HMAC authentication of control channel packets</a>
        </h3>
<p id="section-2.3-1">
          <span><a href="#RFC2104" class="xref">HMAC authentication</a> [<a href="#RFC2104" class="xref">RFC2104</a>]</span> enables an
          additional authentication on the packet level.  HMAC
          authentication is only possible with TLS mode and will only
          impact the control channel.  The data channel is already
          protected by HMAC authentication embedded in the SSL/TLS
          payload.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">
          This authentication can strengthen the overall security on
          both client and server side as OpenVPN will validate the HMAC
          signature before it is sent to the SSL/TLS layer for decryption.
          This can protect server and client from SSL/TLS protocol
          issues from all users not having access to a valid HMAC key.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">
          The keys used for HMAC signatures are static and shared between
          server and all clients.  The default hashing algorithm is HMAC-SHA1
          but any hashing algorithms supported by the SSL/TLS protocol can
          be used as long as the clients and server uses the same algorithm.
          The choice of hashing algorithms defines the length of the HMAC
          field in the control packet.  HMAC-SHA1 uses 20 bytes, HMAC-SHA512
          uses 64 bytes.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<section id="section-2.3.1">
          <h4 id="name-hmac-authentication-subkeys">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-hmac-authentication-subkeys" class="section-name selfRef">HMAC authentication subkeys</a>
          </h4>
<p id="section-2.3.1-1">
            HMAC packet authentication use two independent
            preshared static keys for the authentication.  One key
            is used for signing packets and the other key is used
            to verify signatures from the remote side.  The OpenVPN
            terminology for this is key-direction.  The key-direction
            defines which set of keys is used for signing and for
            verification.  Alle clients MUST use the same
            key-direction while the server MUST use the oposite
            key-direction.<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</section>
<section id="section-3">
      <h2 id="name-encrypting-control-channel-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-encrypting-control-channel-" class="section-name selfRef">Encrypting control channel packets</a>
      </h2>
<p id="section-3-1">
        With OpenVPN v2.4 and later, the client and server MAY use TLS
        control channel encryption instead of HMAC authentication.  This
        operational mode will encrypt the control packet channel payload
        with a static key.  The static keying material is the same which
        HMAC authentication uses, but the key-direction is fixed according
        to the local process' role (server or client).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
        This feature is called tls-crypt, which uses a pre-shared static key (like
        the tls-auth method) to encrypt control channel packets.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
        Encrypting control channel packets has three main advantages:<a href="#section-3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-4.1"> It provides more privacy by hiding the certificate used
          for the TLS connection.<a href="#section-3-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-4.2"> It is harder to identify OpenVPN traffic as such.<a href="#section-3-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-4.3">It provides "poor-man's" post-quantum security, against
          attackers who will never know the pre-shared key
          (i.e. no forward secrecy).<a href="#section-3-4.3" class="pilcrow">¶</a>
</li>
      </ul>
<section id="section-3.1">
        <h3 id="name-control-channel-packet-encr">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-control-channel-packet-encr" class="section-name selfRef">Control channel packet encryption</a>
        </h3>
<p id="section-3.1-1">
          The  following encryption method is usee, based on the SIV
          construction
          <span>[<a href="#rogaway2006provable" class="xref">rogaway2006provable</a>]</span>,
          to achieve nonce misuse-resistant authenticated encryption:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-2">
<pre>
              msg      = control channel plaintext
              header   = opcode (1 byte) || session_id (8 bytes) || packet_id (8
              bytes)
              Ka       = authentication key (256 bits)
              Ke       = encryption key (256 bits)
              (Ka and Ke are pre-shared keys, like with --tls-auth)

              auth_tag = HMAC-SHA256(Ka, header || msg)
              IV       = 128 most-significant bits of auth_tag
              ciph     = AES256-CTR(Ke, IV, msg)

              output   = Header || Tag || Ciph
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">
          This boils down to the following on-the-wire packet format:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-4">
<pre>

              -opcode- || -session_id- || -packet_id- || auth_tag || * payload *

</pre><a href="#section-3.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.1-5">
          Where<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-6.1"> -XXX- means authenticated, and<a href="#section-3.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-6.2"> * XXX * means authenticated and encrypted.<a href="#section-3.1-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-7">
          Which is very similar to the current tls-auth packet format, and has
          the same overhead as "--tls-auth" with "--auth SHA256".<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<p id="section-3.1-8">
          The use of a nonce misuse-resistant authenticated encryption scheme
          allows us to worry less about the risks of nonce collisions.  This is
          important, because in contrast with the data channel in TLS mode, we
          will not be able to rotate tls-crypt keys often or fully guarantee nonce
          uniqueness.  For non misuse-resistant modes such as GCM
          (   <span>[<a href="#ferguson2005authentication" class="xref">ferguson2005authentication</a>]</span>,
          <span>[<a href="#joux2006authentication" class="xref">joux2006authentication</a>]</span>),
          the data channel in TLS mode only has to ensure that the packet counter
          never rolls over, while tls-crypt would have to provide nonce uniqueness
          over all control channel packets sent by all clients, for the lifetime
          of the tls-crypt key.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<p id="section-3.1-9">
          Unlike with tls-auth, no --key-direction has to be specified for
          tls-crypt.  TLS servers always use key direction 1, and TLS clients
          always use key direction 2, which means that client-&gt;server traffic and
          server-&gt;client traffic always use different keys, without requiring
          configuration.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<p id="section-3.1-10">
          Using fixed, secure, encryption and authentication algorithms makes both
          implementation and configuration easier.  If we ever want to, we can
          extend this to support other crypto primitives.  Since tls-crypt should
          provide privacy as well as DoS protection, these should not be made
          negotiable.<a href="#section-3.1-10" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-tls-crypt-security-consider">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-tls-crypt-security-consider" class="section-name selfRef">tls-crypt Security considerations</a>
        </h3>
<p id="section-3.2-1">
          tls-crypt is a best-effort mechanism that aims to provide as much
          privacy and security as possible, while staying as simple as possible.
          The following are some security considerations for this scheme.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
          The same tls-crypt key is potentially shared by a lot of peers, so it
          is quite likely to get compromised.  Once an attacker acquires the
          tls-crypt key, this mechanism no longer provides any security against
          the attacker.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">
          Since many peers potentially use the tls-crypt key for a long time, a
          lot of data might be encrypted under the tls-crypt key.  This leads
          to two potential problems:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">
            <p id="section-3.2-4.1.1">
                The "opcode || session id || packet id" combination might collide.
                This might happen in larger setups, because the session id contains
                just 64 bits or random.  Using the uniqueness requirement from the
                GCM spec <span>[<a href="#nistgcm" class="xref">nistgcm</a>]</span>
                (a collision probability of less than 2^(-32)),
                uniqueness is achieved when using the tls-crypt key for at most
                2^16 (65536) connections per process start.  (The packet id
                includes the daemon start time in the packet ID, which should be
                different after stopping and (re)starting OpenPVN.)<a href="#section-3.2-4.1.1" class="pilcrow">¶</a></p>
<p id="section-3.2-4.1.2">
                And if a collision happens, an attacker can *only* learn whether
                colliding packets contain the same plaintext.  Attackers will not
                be able to learn anything else about the plaintext (unless the
                attacker knows the plaintext of one of these packets, of course).
                Since the impact is limited, I consider this an acceptable
                remaining risk.<a href="#section-3.2-4.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-4.2">
              The IVs used in encryption might collide.  When two IVs collide, an
              attacker can learn the xor of the two plaintexts by xorring the
              ciphertexts.  This is a serious loss of confidentiality.  The IVs
              are 128-bit, so when HMAC-SHA256 is a secure PRF (an assumption
              that must also hold for TLS), and we use the same uniqueness
              requirement from [3], this limits the total amount of control
              channel messages for all peers in the setup to 2^48.  Assuming a
              large setup of 2^16 (65536) clients, and a (conservative) number of
              2^16 control channel packets per connection on average, this means
              that clients may set up 2^16 connections on average.  I think these
              numbers are reasonable.<a href="#section-3.2-4.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-3.3">
        <h3 id="name-client-specific-tls-crypt-k">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-client-specific-tls-crypt-k" class="section-name selfRef">Client-specific tls-crypt keys (tls-crypt-v2)</a>
        </h3>
<p id="section-3.3-1">
          This section describes OpenVPN to use of client-specific tls-crypt keys.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<section id="section-3.3.1">
          <h4 id="name-rationale">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-rationale" class="section-name selfRef">Rationale</a>
          </h4>
<p id="section-3.3.1-1">
            ``--tls-auth`` and ``tls-crypt`` use a pre-shared group key,
            which is shared among all clients and servers in an OpenVPN
            deployment.  If any client or server is compromised, the
            attacker will have access to this shared key, and it
            will no longer provide any security.  To reduce the risk of
            losing pre-shared keys, ``tls-crypt-v2`` adds the ability to
            supply each client with a unique tls-crypt key.  This allows
            large organisations and VPN providers to profit from the same
            DoS and TLS stack protection that small deployments can already
            achieve using ``tls-auth`` or ``tls-crypt``.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">
            Also, for ``tls-crypt``, even if all these peers succeed in
            keeping the key secret, the key lifetime is limited to roughly
            8000 years, divided by the number of clients (see the
            ``--tls-crypt`` section of the man page).  Using client-specific
            keys, we lift this lifetime requirement to roughly 8000 years
            for each client key (which "Should Be Enough For Everybody (tm)").<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.3.2">
          <h4 id="name-introduction-2">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
          </h4>
<p id="section-3.3.2-1">
            ``tls-crypt-v2`` uses an encrypted cookie mechanism to introduce
            client-specific tls-crypt keys without introducing a lot of server-side state.
            The client-specific key is encrypted using a server key.  The server key is the
            same for all servers in a group.  When a client connects, it first sends the
            encrypted key to the server, such that the server can decrypt the key and all
            messages can thereafter be encrypted using the client-specific key.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.3.2-2">
            A wrapped (encrypted and authenticated) client-specific key can also contain
            metadata.  The metadata is wrapped together with the key, and can be used to
            allow servers to identify clients and/or key validity.  This allows the server
            to abort the connection immediately after receiving the first packet, rather
            than performing an entire TLS handshake.  Aborting the connection this early
            greatly improves the DoS resilience and reduces attack surface against
            malicious clients that have the ``tls-crypt`` or ``tls-auth`` key.  This is
            particularly relevant for large deployments (think lost key or disgruntled
            employee) and VPN providers (clients are not trusted).<a href="#section-3.3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.3.2-3">
            To allow for a smooth transition, ``tls-crypt-v2`` is designed such that a
            server can enable both ``tls-crypt-v2`` and either ``tls-crypt`` or
            ``tls-auth``.  This is achieved by introducing a P_CONTROL_HARD_RESET_CLIENT_V3
            opcode, that indicates that the client wants to use ``tls-crypt-v2`` for the
            current connection.<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
</section>
<section id="section-3.3.3">
          <h4 id="name-implementation">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-implementation" class="section-name selfRef">Implementation</a>
          </h4>
<p id="section-3.3.3-1">
            When setting up a tls-crypt-v2 group (similar to generating a tls-crypt or
            tls-auth key previously):<a href="#section-3.3.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.3-2">
              <li id="section-3.3.3-2.1">
              <p id="section-3.3.3-2.1.1">
                Generate a tls-crypt-v2 server key using OpenVPN's ``--genkey tls-crypt-v2-server``.
                This key contains 2 512-bit keys, of which we use:<a href="#section-3.3.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.3-2.1.2.1"> the first 256 bits of key 1 as AES-256-CTR encryption key ``Ke``<a href="#section-3.3.3-2.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-3.3.3-2.1.2.2"> the first 256 bits of key 2 as HMAC-SHA-256 authentication key ``Ka``<a href="#section-3.3.3-2.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-3.3.3-2.1.3">
                This format is similar to the format for regular ``tls-crypt``/``tls-auth``
                and data channel keys, which allows us to reuse code.<a href="#section-3.3.3-2.1.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.3.3-2.2">
                Add the tls-crypt-v2 server key to all server configs
                (``tls-crypt-v2 /path/to/server.key``)<a href="#section-3.3.3-2.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-3.3.3-3">
            When provisioning a client, create a client-specific tls-crypt key:<a href="#section-3.3.3-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.3-4">
              <li id="section-3.3.3-4.1">. Generate 2048 bits client-specific key ``Kc`` using OpenVPN's ``--genkey tls-crypt-v2-client``<a href="#section-3.3.3-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-4.2">
              <p id="section-3.3.3-4.2.1"> Optionally generate metadata.

                 The first byte of the metadata determines the type.  The initial
              implementation supports the following types:<a href="#section-3.3.3-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.3-4.2.2.1">   0x00 (USER):         User-defined free-form data.<a href="#section-3.3.3-4.2.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-3.3.3-4.2.2.2">   0x01 (TIMESTAMP):    64-bit network order unix timestamp of key generation.<a href="#section-3.3.3-4.2.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-3.3.3-4.2.3">
                The timestamp can be used to reject too-old tls-crypt-v2 client keys.<a href="#section-3.3.3-4.2.3" class="pilcrow">¶</a></p>
<p id="section-3.3.3-4.2.4">
                User metadata could for example contain the users certificate serial, such
                that the incoming connection can be verified against a CRL.<a href="#section-3.3.3-4.2.4" class="pilcrow">¶</a></p>
<p id="section-3.3.3-4.2.5">
                If no metadata is supplied during key generation, openvpn defaults to the
                TIMESTAMP metadata type.<a href="#section-3.3.3-4.2.5" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.3.3-4.3">
              <p id="section-3.3.3-4.3.1"> Create a wrapped client key ``WKc``, using the same nonce-misuse-resistant
              SIV construction we use for tls-crypt:<a href="#section-3.3.3-4.3.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3.3-4.3.2">
<pre>
``len = len(WKc)`` (16 bit, network byte order)

``T = HMAC-SHA256(Ka, len || Kc || metadata)``

``IV = 128 most significant bits of T``

``WKc = T || AES-256-CTR(Ke, IV, Kc || metadata) || len``
</pre><a href="#section-3.3.3-4.3.2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.3-4.3.3">

              Note that the length of ``WKc`` can be computed before composing ``WKc``,
              because the length of each component is known (and AES-256-CTR does not add
              any padding).<a href="#section-3.3.3-4.3.3" class="pilcrow">¶</a></p>
</li>
            <li id="section-3.3.3-4.4"> Create a tls-crypt-v2 client key: PEM-encode ``Kc || WKc`` and store in a
              file, using the header ``-----BEGIN OpenVPN tls-crypt-v2 client key-----``
              and the footer ``-----END OpenVPN tls-crypt-v2 client key-----``.  (The PEM
              format is simple, and following PEM allows us to use the crypto lib function
              for en/decoding.)<a href="#section-3.3.3-4.4" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-4.5"> Add the tls-crypt-v2 client key to the client config
              (``tls-crypt-v2 /path/to/client-specific.key``)<a href="#section-3.3.3-4.5" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-3.3.3-5">
            When setting up the openvpn connection:<a href="#section-3.3.3-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3.3-6">

              <li id="section-3.3.3-6.1">. The client reads the tls-crypt-v2 key from its config, and:

              1. loads ``Kc`` as its tls-crypt key,
              2. stores ``WKc`` in memory for sending to the server.<a href="#section-3.3.3-6.1" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-6.2">. To start the connection, the client creates a P_CONTROL_HARD_RESET_CLIENT_V3
              message, wraps it with tls-crypt using ``Kc`` as the key, and appends
              ``WKc``.  (``WKc`` must not be encrypted, to prevent a chicken-and-egg
              problem.)<a href="#section-3.3.3-6.2" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-6.3"> The server receives the P_CONTROL_HARD_RESET_CLIENT_V3 message, and

              1. reads the WKc length field from the end of the message, and extracts WKc
              from the message
              2. unwraps ``WKc``
              3. uses unwrapped ``Kc`` to verify the remaining
              P_CONTROL_HARD_RESET_CLIENT_V3 message's (encryption and) authentication.

              The message is dropped and no error response is sent when either 3.1, 3.2 or
              3.3 fails (DoS protection).<a href="#section-3.3.3-6.3" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-6.4"> Server optionally checks metadata using a --tls-crypt-v2-verify script

              This allows early abort of connection, *before* we expose any of the
              notoriously dangerous TLS, X.509 and ASN.1 parsers and thereby reduces the
              attack surface of the server.

              The metadata is checked *after* the OpenVPN three-way handshake has
              completed, to prevent DoS attacks.  (That is, once the client has proved to
              the server that it possesses Kc, by authenticating a packet that contains the
              session ID picked by the server.)

              A server should not send back any error messages if metadata verification
              fails, to reduce attack surface and maximize DoS resilience.<a href="#section-3.3.3-6.4" class="pilcrow">¶</a>
</li>
            <li id="section-3.3.3-6.5"> Client and server use ``Kc`` for (un)wrapping any following control channel
              messages.<a href="#section-3.3.3-6.5" class="pilcrow">¶</a>
</li>
          </ol>
</section>
<section id="section-3.3.4">
          <h4 id="name-considerations">
<a href="#section-3.3.4" class="section-number selfRef">3.3.4. </a><a href="#name-considerations" class="section-name selfRef">Considerations</a>
          </h4>
<p id="section-3.3.4-1">
To allow for a smooth transition, the server implementation allows
``tls-crypt`` or ``tls-auth`` to be used simultaneously with ``tls-crypt-v2``.
This specification does not allow simultaneously using ``tls-crypt-v2`` and
connections without any control channel wrapping, because that would break DoS
resilience.<a href="#section-3.3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.3.4-2">
WKc includes a length field, so we leave the option for future extension of the
P_CONTROL_HEAD_RESET_CLIENT_V3 message open.  (E.g. add payload to the reset to
indicate low-level protocol features.)<a href="#section-3.3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.3.4-3">
``tls-crypt-v2`` uses fixed crypto algorithms, because:<a href="#section-3.3.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.4-4.1">The crypto is used before we can do any negotiation, so the algorithms have
   to be predefined.<a href="#section-3.3.4-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.4-4.2">The crypto primitives are chosen conservatively, making problems with these
   primitives unlikely.<a href="#section-3.3.4-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.4-4.3">Making anything configurable adds complexity, both in implementation and
usage.  We should not add any more complexity than is absolutely necessary.<a href="#section-3.3.4-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.4-5">
Potential ``tls-crypt-v2`` risks:<a href="#section-3.3.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.4-6.1">Slightly more work on first connection (``WKc`` unwrap + hard reset unwrap)
   than with ``tls-crypt`` (hard reset unwrap) or ``tls-auth`` (hard reset auth).<a href="#section-3.3.4-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.4-6.2">Flexible metadata allow mistakes
   (So we should make it easy to do it right.  Provide tooling to create client
   keys based on cert serial + CA fingerprint, provide script that uses CRL (if
available) to drop revoked keys.)<a href="#section-3.3.4-6.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</section>
</section>
<section id="section-4">
      <h2 id="name-packet-replay-protection">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-packet-replay-protection" class="section-name selfRef">Packet replay protection</a>
      </h2>
<p id="section-4-1">TBD<a href="#section-4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-5">
      <h2 id="name-pushing-configuration-optio">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-pushing-configuration-optio" class="section-name selfRef">Pushing configuration options and OCC</a>
      </h2>
<p id="section-5-1">
      TBD<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6">
      <h2 id="name-openvpn-key">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-openvpn-key" class="section-name selfRef">OpenVPN Key</a>
      </h2>
<p id="section-6-1">
      OpenVPN uses a 256 byte of key material for encryuption decrypting the data
      channel. The format of this key material is the following:<a href="#section-6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6-2">
<pre>
      struct datakeys {
         uint8_t key_c2s[64];
         uint8_t auth_c2s[64];
         uint8_t key_s2c[64];
         uint8_t auth_s2c[64];
      }
</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
<p id="section-6-3">

      All these keys provide more than enough material to provide encryption keys
      are all encryption and authentication algorithms. E.g. when 128key is required
      for a encryption cipher, only the first 16 bytes are used.

      key_c2s and auth_c2s are used to encrypt/authenticate data from client to server
      and key_s2c and auth_s2c are used to encrypt/authenticate from server to client.

      This key structure is normally generated by using RFC 5705 Key Material Exporter
      from the Control Channel session with the label ``EXPORTER-OpenVPN-datakeys``
      and using the 256 bytes length of the structure.

      Older clients use the mechansim described in the section OpenVPN data channel
      PRF (TODO).<a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
<section id="section-7">
      <h2 id="name-communictaion-channels">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-communictaion-channels" class="section-name selfRef">Communictaion channels</a>
      </h2>
<p id="section-7-1">
        OpenVPN communictates over two channels which are multiplexed over the
        same connection; control channel and data channel.  The control
        channel is used for passing configuration and environment data between
        each side of the tunnel, including encryption session keys.  The data
        channel carries the encrypted tunnel data.  The OPCODE determines which
        channel the packet belongs to.<a href="#section-7-1" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-overview-of-opcodes">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-overview-of-opcodes" class="section-name selfRef">Overview of OPCODEs</a>
        </h3>
<p id="section-7.1-1">
          Each packet MUST contain an OPCODE.  This is located within the first
          byte in each UDP packet and the third byte in TCP packets.  The high 5
          bits contains the OPCODE and the lower 3 bits defines a key-id.  The
          OPCODE defines the contents of the following payload.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">OPCODE</th>
              <th class="text-left" rowspan="1" colspan="1">Channel</th>
              <th class="text-left" rowspan="1" colspan="1">Short name</th>
              <th class="text-left" rowspan="1" colspan="1">Payload</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_HARD_RESET_CLIENT_V1</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">Obsolete</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_HARD_RESET_SERVER_V1</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">Obsolete</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_SOFT_RESET_V1</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">Obsolete</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_V1</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">ACK_V1</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">6</td>
              <td class="text-left" rowspan="1" colspan="1">Data</td>
              <td class="text-left" rowspan="1" colspan="1">DATA_V1</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">7</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_HARD_RESET_CLIENT_V2</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">8</td>
              <td class="text-left" rowspan="1" colspan="1">Control</td>
              <td class="text-left" rowspan="1" colspan="1">CONTROL_HARD_RESET_SERVER_V2</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">9</td>
              <td class="text-left" rowspan="1" colspan="1">Data</td>
              <td class="text-left" rowspan="1" colspan="1">DATA_V2</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">Current</td>
            </tr>
          </tbody>
        </table>
</section>
<section id="section-7.2">
        <h3 id="name-the-control-channel">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-the-control-channel" class="section-name selfRef">The Control Channel</a>
        </h3>
<p id="section-7.2-1">
          The control channel is used to pass configuration and environment
          information in addition to handle the SSL/TLS handshake process
          between the server and client.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<section id="section-7.2.1">
          <h4 id="name-control-channel-wire-packet">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-control-channel-wire-packet" class="section-name selfRef">Control channel wire packet structure</a>
          </h4>
<p id="section-7.2.1-1">
            The following table lists all fields found in control channel
            packets.  The fields arrive in the order they are listed in the
            table.<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-2">
            The  TCP/UDP column indicates if the corresponding field is present
            when using TCP and/or UDP as transport protocol.  When the TLS mode
            column contains an X it means the field is used when the connection
            is a server/clients based connection.  These fields are not used in
            Peer-to-Peer connections.<a href="#section-7.2.1-2" class="pilcrow">¶</a></p>
<p id="section-7.2.1-3">
            The TLS auth column indicates fields used when additional
            HMAC authentication data is added to the control channel packets<a href="#section-7.2.1-3" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
            <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field name</th>
                <th class="text-right" rowspan="1" colspan="1">Length (bits)</th>
                <th class="text-center" rowspan="1" colspan="1">TLS auth</th>
                <th class="text-left" rowspan="1" colspan="1">Comment</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">pkt_len</td>
                <td class="text-right" rowspan="1" colspan="1">16</td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1">Packet length (TCP only)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">OPCODE</td>
                <td class="text-right" rowspan="1" colspan="1">5</td>
                <td class="text-center" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">key_id</td>
                <td class="text-right" rowspan="1" colspan="1">3</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">own session_id</td>
                <td class="text-right" rowspan="1" colspan="1">64</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">HMAC</td>
                <td class="text-right" rowspan="1" colspan="1">128-512</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">Algorithm defines length</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">replay_packet_id</td>
                <td class="text-right" rowspan="1" colspan="1">64</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">Id used for replay protection</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">acked_pktid_len</td>
                <td class="text-right" rowspan="1" colspan="1">8</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">OPTIONAL</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">acked_pktid_list</td>
                <td class="text-right" rowspan="1" colspan="1">32 * n</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">List length defined by acked_pktid_len.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">peer session id</td>
                <td class="text-right" rowspan="1" colspan="1">64</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">Session ID of the remote peer. Present if acked_pktid_len &gt;= 1</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">packet_id</td>
                <td class="text-right" rowspan="1" colspan="1">64</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">ID of the control channel packet</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">payload</td>
                <td class="text-right" rowspan="1" colspan="1">(var)</td>
                <td class="text-center" rowspan="1" colspan="1">X</td>
                <td class="text-left" rowspan="1" colspan="1">Can be empty</td>
              </tr>
            </tbody>
          </table>
<section id="section-7.2.1.1">
            <h5 id="name-field-pkt_len">
<a href="#section-7.2.1.1" class="section-number selfRef">7.2.1.1. </a><a href="#name-field-pkt_len" class="section-name selfRef">Field: pkt_len</a>
            </h5>
<p id="section-7.2.1.1-1">
              This field is only present when TCP is used as the transport
              protocol.  This value should be the number of bytes being
              transported in this packet, excluding the pkt_len field.<a href="#section-7.2.1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.2">
            <h5 id="name-field-opcode">
<a href="#section-7.2.1.2" class="section-number selfRef">7.2.1.2. </a><a href="#name-field-opcode" class="section-name selfRef">Field: OPCODE</a>
            </h5>
<p id="section-7.2.1.2-1">
              The OPCODE field is described in detail in the
              "Control Channel OPCODEs" section.<a href="#section-7.2.1.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.3">
            <h5 id="name-field-key_id">
<a href="#section-7.2.1.3" class="section-number selfRef">7.2.1.3. </a><a href="#name-field-key_id" class="section-name selfRef">Field: key_id</a>
            </h5>
<p id="section-7.2.1.3-1">
              This is used to indicate which keys to use when
              processing the payload.  This has a range from 0 to
              7. All new sessions starts with key_id 0. After a key
              renogitation the key_id will increase by one. After
              key_id 7, the key_id wraps to 1.<a href="#section-7.2.1.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.4">
            <h5 id="name-field-session_id">
<a href="#section-7.2.1.4" class="section-number selfRef">7.2.1.4. </a><a href="#name-field-session_id" class="section-name selfRef">Field: session_id</a>
            </h5>
<p id="section-7.2.1.4-1">
              This is a unique random value for a particular connected
              session.  If an established session needs a full reconnect,
              the session ID MUST be changed.  Client and server have
              their own independent session ID.<a href="#section-7.2.1.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.5">
            <h5 id="name-field-hmac">
<a href="#section-7.2.1.5" class="section-number selfRef">7.2.1.5. </a><a href="#name-field-hmac" class="section-name selfRef">Field: HMAC</a>
            </h5>
<p id="section-7.2.1.5-1">
              Contains the HMAC signature for this packet if the HMAC
              authentication have been enabled.  The length of this
              field will vary according to the requirements of the
              hashing algorithm.<a href="#section-7.2.1.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.6">
            <h5 id="name-field-replay_packet_id">
<a href="#section-7.2.1.6" class="section-number selfRef">7.2.1.6. </a><a href="#name-field-replay_packet_id" class="section-name selfRef">Field: replay_packet_id</a>
            </h5>
<p id="section-7.2.1.6-1">
              This is an incremental ID for each packet which helps
              discovering packet replay attacks. Usually consists of
              a 32 bit time + 32 bit counter but can be any monotonically
              increasing sequence For both fields the value is
              transfered using network byte order<a href="#section-7.2.1.6-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1.6-2">
              For CFB/OFB based ciphers, the long packet_id format MUST be
              used, as the packet_id is part of the cipher's IV.
              [FIXME/syzzer: Elaborate more]
              [FIXME/schabe: move to data channel]<a href="#section-7.2.1.6-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.7">
            <h5 id="name-field-acked_pktid_len">
<a href="#section-7.2.1.7" class="section-number selfRef">7.2.1.7. </a><a href="#name-field-acked_pktid_len" class="section-name selfRef">Field: acked_pktid_len</a>
            </h5>
<p id="section-7.2.1.7-1">
              Defines the number of acked packet IDs being reported in this
              packet.  If set to 0, no acked packet ID elements wil be found,
              otherwise the following 4 bytes * acked_pktid_len of data
              will contain the list of acked packet IDs.<a href="#section-7.2.1.7-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.8">
            <h5 id="name-field-acked_pktid_list">
<a href="#section-7.2.1.8" class="section-number selfRef">7.2.1.8. </a><a href="#name-field-acked_pktid_list" class="section-name selfRef">Field: acked_pktid_list</a>
            </h5>
<p id="section-7.2.1.8-1">
              This field contains the packet ID which the remote side have
              received and processed.  This field will appear up to
              acked_pktid_len number of times, each with an individual packet
              ID.  These packet IDs should be found in a local cache of sent
              packet IDs.  If not found, the communication may have been
              manipulated.<a href="#section-7.2.1.8-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.1.9">
            <h5 id="name-field-payload">
<a href="#section-7.2.1.9" class="section-number selfRef">7.2.1.9. </a><a href="#name-field-payload" class="section-name selfRef">Field: payload</a>
            </h5>
<p id="section-7.2.1.9-1">
              The payload to be processed.  This is most commonly an
              encrypted blob which is expected to be passed on to
              the SSL/TLS library for further processing.
              [FIXME: Elaborate more]<a href="#section-7.2.1.9-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-7.2.2">
          <h4 id="name-control-channel-opcodes">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-control-channel-opcodes" class="section-name selfRef">Control Channel OPCODEs</a>
          </h4>
<section id="section-7.2.2.1">
            <h5 id="name-opcode-id-1-control_hard_re">
<a href="#section-7.2.2.1" class="section-number selfRef">7.2.2.1. </a><a href="#name-opcode-id-1-control_hard_re" class="section-name selfRef">[OPCODE ID 1] CONTROL_HARD_RESET_CLIENT_V1</a>
            </h5>
<p id="section-7.2.2.1-1">
              OBSOLETE: This OPCODE is not in use any more.<a href="#section-7.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.1-2">
              This MAY be reused in the future once all other OPCODE
              slots are in use.<a href="#section-7.2.2.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.2">
            <h5 id="name-opcode-id-2-control_hard_re">
<a href="#section-7.2.2.2" class="section-number selfRef">7.2.2.2. </a><a href="#name-opcode-id-2-control_hard_re" class="section-name selfRef">[OPCODE ID 2] CONTROL_HARD_RESET_SERVER_V1</a>
            </h5>
<p id="section-7.2.2.2-1">
              OBSOLETE: This OPCODE is not in use any more.<a href="#section-7.2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.2-2">
              This MAY be reused in the future once all other OPCODE
              slots are in use.<a href="#section-7.2.2.2-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.3">
            <h5 id="name-opcode-id-3-control_soft_re">
<a href="#section-7.2.2.3" class="section-number selfRef">7.2.2.3. </a><a href="#name-opcode-id-3-control_soft_re" class="section-name selfRef">[OPCODE ID 3] CONTROL_SOFT_RESET_V1</a>
            </h5>
<p id="section-7.2.2.3-1">
              Start new TLS session to generate a new data channel key
              to allow a graceful transition from old to new key<a href="#section-7.2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.3-2">
              This is used to rotate session keys.  It allows both
              a new key and the old ones to be valid for a limited
              transition window.  The transition window size is
              decided by the server.  This window SHOULD NOT
              exceed the expected renegotiation cycle.<a href="#section-7.2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-7.2.2.3-3">
              Either client or server CAN send a CONTROL_SOFT_RESET_V1
              packet to the remote side.  The remote side MUST respond
              with a CONTROL_SOFT_RESET_V1 message to acknowledge that
              a renegotiation of the session keys will start.  Then
              the side receiving the last CONTROL_SOFT_RESET_V1 packet
              replies with a ACK_V1 message.  At this point the
              renegotation can start using the CONTROL_V1 OPCODE.<a href="#section-7.2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-7.2.2.3-4">
              When the ACK_V1 packet is being sent, the key_id field
              MUST be incremented to ensure the connection can still
              use the old keys for a shorter time until the transistion
              has completed.  Any following packets need to use the new
              key-id until the old key have been removed and the new
              key-id replaces it completely. (schwabe:FIXME THIS WRONG)<a href="#section-7.2.2.3-4" class="pilcrow">¶</a></p>
<p id="section-7.2.2.3-5">
              [FIXME: Elaborate more on how re-keying happens]<a href="#section-7.2.2.3-5" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.4">
            <h5 id="name-opcode-id-4-control_v1">
<a href="#section-7.2.2.4" class="section-number selfRef">7.2.2.4. </a><a href="#name-opcode-id-4-control_v1" class="section-name selfRef">[OPCODE ID 4] CONTROL_V1</a>
            </h5>
<p id="section-7.2.2.4-1">
              Control channel packet, usually TLS protocol data<a href="#section-7.2.2.4-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.4-2">
              CONTROL_V1 is used to encapsulate the SSL/TLS protocol into the
              OpenVPN wire packet, primarily used for the SSL/TLS handshake
              process.  The payload of CONTROL_V1 packets are expected to be
              processed by an SSL/TLS library.  Once the SSL/TLS handshake
              have completed and the ephemeral session key have been
              negotiated, encrypted tunnel data will use either DATA_V1 or
              DATA_V2 for the transport of those packets.<a href="#section-7.2.2.4-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.5">
            <h5 id="name-opcode-id-5-ack_v1">
<a href="#section-7.2.2.5" class="section-number selfRef">7.2.2.5. </a><a href="#name-opcode-id-5-ack_v1" class="section-name selfRef">[OPCODE ID 5] ACK_V1</a>
            </h5>
<p id="section-7.2.2.5-1">
              Acknowledgement for received control channel packets<a href="#section-7.2.2.5-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.5-2">
              When control channel packets have been received an ACK_V1
              packet is sent back to confirm its arrival.  It SHOULD NOT
              be sent an ACK_V1 message upon receiving an ACK_V1 message.<a href="#section-7.2.2.5-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.6">
            <h5 id="name-opcode-id-7-control_hard_re">
<a href="#section-7.2.2.6" class="section-number selfRef">7.2.2.6. </a><a href="#name-opcode-id-7-control_hard_re" class="section-name selfRef">[OPCODE ID 7] CONTROL_HARD_RESET_CLIENT_V2</a>
            </h5>
<p id="section-7.2.2.6-1">
              Initial key from client, forget previous state<a href="#section-7.2.2.6-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.6-2">
              The client starts with a fresh new session key.  This tells the server
              to initiate a new TLS handshake and establish a new session key for
              data channel going from client to server.<a href="#section-7.2.2.6-2" class="pilcrow">¶</a></p>
</section>
<section id="section-7.2.2.7">
            <h5 id="name-opcode-id-8-control_hard_re">
<a href="#section-7.2.2.7" class="section-number selfRef">7.2.2.7. </a><a href="#name-opcode-id-8-control_hard_re" class="section-name selfRef">[OPCODE ID 8] CONTROL_HARD_RESET_SERVER_V2</a>
            </h5>
<p id="section-7.2.2.7-1">
              Initial key from server, forget previous state.<a href="#section-7.2.2.7-1" class="pilcrow">¶</a></p>
<p id="section-7.2.2.7-2">
              [FIXME: TBD]
              Similar to CONTROL_HARD_RESET_CLIENT_V2, but initiated from
              the server side.<a href="#section-7.2.2.7-2" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-7.2.3">
          <h4 id="name-push-messages">
<a href="#section-7.2.3" class="section-number selfRef">7.2.3. </a><a href="#name-push-messages" class="section-name selfRef">PUSH messages</a>
        </h4>
</section>
<section id="section-7.2.4">
          <h4 id="name-peer-info">
<a href="#section-7.2.4" class="section-number selfRef">7.2.4. </a><a href="#name-peer-info" class="section-name selfRef">Peer-Info</a>
        </h4>
</section>
</section>
<section id="section-7.3">
        <h3 id="name-the-data-channel">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-the-data-channel" class="section-name selfRef">The Data Channel</a>
        </h3>
<section id="section-7.3.1">
          <h4 id="name-opcode-id-9-data_v2">
<a href="#section-7.3.1" class="section-number selfRef">7.3.1. </a><a href="#name-opcode-id-9-data_v2" class="section-name selfRef">[OPCODE ID 9] DATA_V2</a>
          </h4>
<p id="section-7.3.1-1">
            Data channel packet with 4-byte header.  This is
            similar to DATA_V1 with an additional field of 24 bits
            for Peer-ID.<a href="#section-7.3.1-1" class="pilcrow">¶</a></p>
<p id="section-7.3.1-2">
            The table below describes each field and the order of the fields
            found in DATA_V2 packets.<a href="#section-7.3.1-2" class="pilcrow">¶</a></p>
<table class="center" id="table-3">
            <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field name</th>
                <th class="text-right" rowspan="1" colspan="1">Length (bits)</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">op_code</td>
                <td class="text-right" rowspan="1" colspan="1">9 or</td>
                <td class="text-left" rowspan="1" colspan="1">Must always be DATA_V2</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">key_id</td>
                <td class="text-right" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">peer_id</td>
                <td class="text-right" rowspan="1" colspan="1">24</td>
                <td class="text-left" rowspan="1" colspan="1">Peer-ID of the client.  0xFFFFFF disables Peer-ID.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">payload</td>
                <td class="text-right" rowspan="1" colspan="1">(var)</td>
                <td class="text-left" rowspan="1" colspan="1">Encrypted data including HMAC</td>
              </tr>
            </tbody>
          </table>
</section>
<section id="section-7.3.2">
          <h4 id="name-opcode-id-6-data_v1">
<a href="#section-7.3.2" class="section-number selfRef">7.3.2. </a><a href="#name-opcode-id-6-data_v1" class="section-name selfRef">[OPCODE ID 6] DATA_V1</a>
          </h4>
<p id="section-7.3.2-1">
            The DATA_V1 packet is identical to the DATA_V2 packet apart from
            op_code being 6 and the peer_id absent from the packet format
            (all followings fields are shifted by 3 bytes to the left).<a href="#section-7.3.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-7.4">
        <h3 id="name-aead-encrypted-data-channel">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-aead-encrypted-data-channel" class="section-name selfRef">AEAD encrypted data channel packet</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-7.4-1">
<pre>

              struct aead_packet {
              int opcode:5;
              int key_id:3;
              int peer_id:24;
              uint32_t packet_id;
              uint8_t[16] authentication_tag;
              uint8_t* encrypted_payload;
              }
</pre><a href="#section-7.4-1" class="pilcrow">¶</a>
</div>
<p id="section-7.4-2">
          The packet_id together with the implicit IV forms the IV for decryption.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<p id="section-7.4-3">
          IV = paket_id | implicit_iv;<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<p id="section-7.4-4">
          The implicit part of IV is filled by first bytes of the auth_c2s/auth_s2c of
          the data channel key. For the current implemented AEAD ciphers
          Chacha20-Poly1305 and AES-GCM the IV length is 96 bits, 32 bits are
          from packet_id and the remaining 64 bits (the implicit IV part) are
          taken from the data channel key.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<p id="section-7.4-5">
          For DATA_V2 packets the authenticated data *includes* opcode,
          key_id and peer_id. For DATA_V1 packets the authenticated data starts
          on the first byte of packet_id, not including opcode and key_id.<a href="#section-7.4-5" class="pilcrow">¶</a></p>
<p id="section-7.4-6">
          authenticated_data_v1 = packet_id | payload<a href="#section-7.4-6" class="pilcrow">¶</a></p>
<p id="section-7.4-7">
          authenticated_data_v2 = opcode| key_id | peer_id | packet_id | payload<a href="#section-7.4-7" class="pilcrow">¶</a></p>
<p id="section-7.4-8">
          The tag size (as in TLS) is always 128 bit (16 bytes).<a href="#section-7.4-8" class="pilcrow">¶</a></p>
</section>
<section id="section-7.5">
        <h3 id="name-cbc-ofb-ctr-encrypted-packe">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-cbc-ofb-ctr-encrypted-packe" class="section-name selfRef">CBC/OFB/CTR encrypted packet</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-7.5-1">
<pre>
              struct data_packet_cbc {
              int opcode:5;
              int key_id:3;
              int peer_id:24;
              uint8_t[HMAC_LEN] hmac;
              uint8_t[IV_LEN] iv;
              uint32_t encrypted_packet_id;
              uint8_t* encrypted_payload
              }
</pre><a href="#section-7.5-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-7.5-2">
<pre>

              struct data_packet_xfb {
              int opcode:5;
              int key_id:3;
              int peer_id:24;
              uint8_t[HMAC_LEN] hmac;
              uint8_t[IV_LEN] iv;
              uint8_t* encrypted_payload
              }
</pre><a href="#section-7.5-2" class="pilcrow">¶</a>
</div>
<p id="section-7.5-3">HMAC_LEN depends on the length of the HMAC being used, e.g. 20 bytes for
          SHA1, 32 for SHA256. If no authentication is used (DEPRECATED) then the
          length of the field is 0.<a href="#section-7.5-3" class="pilcrow">¶</a></p>
<p id="section-7.5-4">The HMAC is computed over the complete remainder of the packet. opcode,
          key_id, and peer_id are NOT included in the HMAC calculation. If HMAC verification
          fails decryption of the packet MUST NOT be attempted. OpenVPN implements the
          encrypt-then-MAC approach.<a href="#section-7.5-4" class="pilcrow">¶</a></p>
<p id="section-7.5-5">IV_LEN depends on the IV of used cipher. For AES in CBC, CFB and OFB this
          is 128 bits, for Blowfish in CBC mode (DEPRECATED) 64 The. For generating
          the IV use best pratices. OpenVPN generates the CBC IV as random bytes
          with an PRNG. For OFB and CFB the IV has the following format:<a href="#section-7.5-5" class="pilcrow">¶</a></p>
<p id="section-7.5-6">IV = 64 bit packet ID | IV_remainder<a href="#section-7.5-6" class="pilcrow">¶</a></p>
<p id="section-7.5-7">The IV_remainder SHOULD be random bytes. OpenVPN 2.x uses all zeros instead.<a href="#section-7.5-7" class="pilcrow">¶</a></p>
<p id="section-7.5-8">bit packet ID in CBC mode is encrypted and before the payload. In contrast
          to that, the packet ID in OFB and CFB mode are the first 64 bit of the IV.<a href="#section-7.5-8" class="pilcrow">¶</a></p>
<p id="section-7.5-9">For unecrypted data packets the same format as CBC without IV is used.<a href="#section-7.5-9" class="pilcrow">¶</a></p>
</section>
<section id="section-7.6">
        <h3 id="name-packet-id">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-packet-id" class="section-name selfRef">Packet ID</a>
        </h3>
<p id="section-7.6-1">
          The packet ID is an increasing ID that is tied to a key id. For each
          key_id the packet id is independent and starts at 0.

          TODO: Looking at AEAD packets allows figuring out how many packets have been
          sent, is is a problem?<a href="#section-7.6-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-8">
      <h2 id="name-peer-id">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-peer-id" class="section-name selfRef">Peer-ID</a>
      </h2>
<p id="section-8-1">
        The Peer-ID implementation is optional.  The purpose of this feature
        is to allow a client to float between various client IP addresses and
        UDP ports.  When a client floats it means that the established
        encryption and session keys will be reused when the client's source IP
        address or source port changes.  Reasons for such changes can be NAT
        firewalls interrupting longer lasting established connections, mobile
        devices moving from WLAN to a mobile data carrier (such as GPRS, 3G,
        LTE, etc) and similar scenarios.<a href="#section-8-1" class="pilcrow">¶</a></p>
<section id="section-8.1">
        <h3 id="name-requirements">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-requirements" class="section-name selfRef">Requirements</a>
        </h3>
<p id="section-8.1-1">
          Each client implementing Peer-ID support MUST support the IV_PROTO=2
          wire protocol and MUST indicate this to the server through the
          peer-info response.   By sending IV_PROTO=2 to the server, it means
          the client will be able to use the DATA_V2 packet format.  When
          the server acknowledges that the client supports IV_PROTO=2/DATA_V2
          it SHOULD assign a unique Peer-ID to the client.  The server is
          responsible of keeping track of which Peer-ID is related to which
          active session and MUST ensure no active clients share the same
          Peer-ID.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">
          Clients MUST accept the peer-id option being passed to it via a
          PUSH_REPLY message and SHOULD use this value as the Peer-ID in all
          DATA_V2 packets.  Clients MUST provide a valid Peer-ID in all
          DATA_V2 packets, but it can be the ID used to indicate Peer-ID being
          disabled.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">
          Server implementations MUST support the IV_PROTO=2 and the DATA_V2
          packet format and MUST evaluate the response from the client before
          assigning and pushing a peer-id option to the client.  The server
          can use both DATA_V1 and DATA_V2 packet formats when communicating
          with the clients.  If the server chooses to use DATA_V2, the server
          MUST use the disabled Peer-ID reference to the client.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">
          The client is not expected to parse the Peer-ID in DATA_V2 packets.
          The server should send the same Peer-ID provided in packets from the
          server to client.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">
          The Peer-ID is included protected in the HMAC signature/AEAD tag 
          of  DATA_V2 packets.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
</section>
<section id="section-8.2">
        <h3 id="name-allowing-floating-clients">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-allowing-floating-clients" class="section-name selfRef">Allowing floating clients</a>
        </h3>
<p id="section-8.2-1">
          The server MUST ensure the packet integrity is intact, through
          checking HMAC or GCM authentication tags, replay protection, etc
          of the DATA_V2 packet<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">
          In addition the server MUST ensure the float does not clobber
          a pre-existing client, such as a the client floating to a source
          IP address used by a different client unless it can be verified
          that the pre-existing client is a previous instance of the
          floating client.

          [FIXME: Verify.  What if several independent clients float to same source IP?]<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-9">
      <h2 id="name-control-channel-messages">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-control-channel-messages" class="section-name selfRef">Control channel messages</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-message-format">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-message-format" class="section-name selfRef">Message format</a>
        </h3>
<p id="section-9.1-1">
          After the control channel has been established the format switch from the binary format of
          the key exchange message to a text based format. The message are sent in plain text. The
          current implementation does not allow a message to span more than one TLS record.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-9.2">
        <h3 id="name-push_request">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-push_request" class="section-name selfRef">PUSH_REQUEST</a>
        </h3>
<p id="section-9.2-1">
          Format: "PUSH_REQUEST"<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">
          This message is sent from the client to the server and instructs the server that the
          client is ready to receive a "PUSH_RPELY" message. The message is periodically repeated
          until the PUSH_REPLY is received for compatibilit with old OpenVPN servers and to act as
          a keepalive.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
</section>
<section id="section-9.3">
        <h3 id="name-push_reply">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-push_reply" class="section-name selfRef">PUSH_REPLY</a>
        </h3>
<p id="section-9.3-1">
          Format: "PUSH_REPLY [comma seperated options]"<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">
          This message is sent from the server to the client and has dynamic configuration for the client.
          See the section "dynamic configuration option" for a detailed description of the options.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
<section id="section-9.4">
        <h3 id="name-auth_pending">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-auth_pending" class="section-name selfRef">AUTH_PENDING</a>
        </h3>
<p id="section-9.4-1">
          Format:
          "AUTH_PENDING"
          
          or
          
          "AUTH_PENDING,flags"<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">
          This message is sent from the server to the client to indicate that a multi factor authentication is in use
          and the authentication is not completed. The authentication can continue inband or out-of-band.
          
          flags is a comma seperate key-value list. Currently timeout time is defined and defines the maximum time the server
          expects the client to stay in the pending auth state. 
          The client indicates if the extended format with flags is supported by setting
          the IV_PROTO_AUTH_PENDING_KW bit in the IV_PROTO
          client variable. All new clients MUST support the extended format.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
</section>
<section id="section-9.5">
        <h3 id="name-restart-and-halt">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-restart-and-halt" class="section-name selfRef">RESTART and HALT</a>
        </h3>
<p id="section-9.5-1">
          Format:

          "RESTART[,message]"
          "HALT[,message]"

          and

          "RESTART,[[flags]]message"<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<p id="section-9.5-2">
          These message are sent from the server to the client and the client to
          terminate a session. With HALT the client is expected to also not try to
          try reconnect. With RESTART the client is expected to reconnect. flags is
          a list of characters that must follow direclty after the comman and is
          enclosed in [ and ]. The client SHOULD purge username and password before
          reconnecting if flags contains 'P' and reconnect to the next server unless
          'N' is in flags in which case it should reconnect to the same server. E.g.
          when the client receives a "RESTART[PN]" message it should reconnect to same
          server with the same username and password.

          The optional message indicates a message that can relayed to the user.<a href="#section-9.5-2" class="pilcrow">¶</a></p>
</section>
<section id="section-9.6">
        <h3 id="name-auth_failed">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-auth_failed" class="section-name selfRef">AUTH_FAILED</a>
        </h3>
<p id="section-9.6-1">
          Format:

          AUTH_FAILED[,message]

          AUTH_FAILED,SESSION:message

          AUTH_FAILED,TEMP[keywords]:message
          AUTH_FAILED,TEMP:message<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<p id="section-9.6-2">
          This message indicates to a client that an authentication attempt was unsuccessful.
          This message is mostly send in response to a PULL_REQUEST or when a client attempts to
          renegotiates a TLS session.

          The optional message can be relayed to the user. If the message starts with SESSION, this
          indicates that current creditals are longer valid. This is mostly used to indicate that
          the temporary session creditionals that were pushed with "auth-token" and "auth-token-user"
          should be purged and the client should reconnect in the same way as a new connection.

          The AUTH_FAILED,TEMP message indicates that the authentication temporarily failed and should
          the client continue to retry to connect. The server can optionally give a user readable message
          and hint the client a behaviour how to proceed. The keywords of AUTH_FAILED,TEMP are comma seperated
          keys/values. Currently defined are:<a href="#section-9.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.6-3.1"> backoff s - instructs the client to wait at least s seconds before the next connection attempt. If
            the client has already a higher delay before reconnecting, the dealy should NOT be shortend.<a href="#section-9.6-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.6-3.2"> advance addr - Instructs the client to reconnect to the (IP) address of the current server.<a href="#section-9.6-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.6-3.3"> advance remote - Instructs the client to skip the remaining IP addresses of the current server and instead
            connect to the next server specified in the configuration file<a href="#section-9.6-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.6-3.4"> advance no - Instructs the client to retry connecting to the same server again.<a href="#section-9.6-3.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.6-4">
          For example a server that might send "AUTH_FAILED,TEMP[backoff 42,advance no]: No free IP addresses" to indicate
          that the VPN connection can currently not succeed and instructs the client to retry in 42s again.

          The client will announce the capability of understanding AUTH_FAILED,TEMP message by setting the
          IV_PROTO_AUTH_FAILED_TEMP bit in IV_PROTO. A client that does not understand the AUTH_FAILED,TEMP message
          will treat this recoverable error as a non-recoverable error.<a href="#section-9.6-4" class="pilcrow">¶</a></p>
</section>
<section id="section-9.7">
        <h3 id="name-cr_response">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-cr_response" class="section-name selfRef">CR_RESPONSE</a>
        </h3>
<p id="section-9.7-1">
          Format:

          CR_RESPONSE,base64reply<a href="#section-9.7-1" class="pilcrow">¶</a></p>
<p id="section-9.7-2">
          This message indicates a reply to prior challenge/response request. The response is specific to the
          challenge response and is encoded with base64.<a href="#section-9.7-2" class="pilcrow">¶</a></p>
</section>
<section id="section-9.8">
        <h3 id="name-info_pre-and-info">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-info_pre-and-info" class="section-name selfRef">INFO_PRE and INFO</a>
        </h3>
<p id="section-9.8-1">
          Format:

          INFO_PRE,EXTRA

          INFO,EXTRA<a href="#section-9.8-1" class="pilcrow">¶</a></p>
<p id="section-9.8-2">
          This message is used to send pending auth parameters. See the section on pending auth for more details
          on the format of the EXTRA parameter.<a href="#section-9.8-2" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-10">
      <h2 id="name-cryptography">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-cryptography" class="section-name selfRef">Cryptography</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-openvpn-and-the-ssl-tls-pro">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-openvpn-and-the-ssl-tls-pro" class="section-name selfRef">OpenVPN and the SSL/TLS protocol</a>
        </h3>
<p id="section-10.1-1">TBD<a href="#section-10.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10.2">
        <h3 id="name-cipher-negotiation">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-cipher-negotiation" class="section-name selfRef">Cipher negotiation</a>
        </h3>
<p id="section-10.2-1">TBD<a href="#section-10.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10.3">
        <h3 id="name-tls-mode-and-pki">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-tls-mode-and-pki" class="section-name selfRef">TLS mode and PKI</a>
        </h3>
<p id="section-10.3-1">TBD<a href="#section-10.3-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-11">
      <h2 id="name-user-authentication">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-user-authentication" class="section-name selfRef">User authentication</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-user-password-authenticatio">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-user-password-authenticatio" class="section-name selfRef">User/password authentication</a>
        </h3>
<p id="section-11.1-1">TBD<a href="#section-11.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-11.2">
        <h3 id="name-challenge-response-authenti">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-challenge-response-authenti" class="section-name selfRef">Challenge-Response authentication</a>
        </h3>
<p id="section-11.2-1">TBD<a href="#section-11.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-12">
      <h2 id="name-normative-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="ferguson2005authentication">[ferguson2005authentication]</dt>
      <dd>
<span class="refAuthor">Ferguson, N.</span>, <span class="refTitle">"Authentication weaknesses in GCM"</span>, <time datetime="2005" class="refDate">2005</time>. </dd>
<dd class="break"></dd>
<dt id="joux2006authentication">[joux2006authentication]</dt>
      <dd>
<span class="refAuthor">Joux, A.</span>, <span class="refTitle">"Authentication failures in NIST version of GCM (2006)"</span>, <time datetime="2006" class="refDate">2006</time>. </dd>
<dd class="break"></dd>
<dt id="nistgcm">[nistgcm]</dt>
      <dd>
<span class="refAuthor">Dworkin, M. J.</span>, <span class="refTitle">"Sp 800-38d. recommendation for block cipher modes of operation: Galois/counter mode (gcm) and gmac"</span>, <time datetime="2007" class="refDate">2007</time>. </dd>
<dd class="break"></dd>
<dt id="RFC2104">[RFC2104]</dt>
      <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refAuthor">Bellare, M.</span>, and <span class="refAuthor">R. Canetti</span>, <span class="refTitle">"HMAC: Keyed-Hashing for Message Authentication"</span>, <span class="seriesInfo">RFC 2104</span>, <span class="seriesInfo">DOI 10.17487/RFC2104</span>, <time datetime="1997-02" class="refDate">February 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2104">https://www.rfc-editor.org/info/rfc2104</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5246">[RFC5246]</dt>
      <dd>
<span class="refAuthor">Dierks, T.</span> and <span class="refAuthor">E. Rescorla</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.2"</span>, <span class="seriesInfo">RFC 5246</span>, <span class="seriesInfo">DOI 10.17487/RFC5246</span>, <time datetime="2008-08" class="refDate">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5246">https://www.rfc-editor.org/info/rfc5246</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
      <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="rogaway2006provable">[rogaway2006provable]</dt>
    <dd>
<span class="refAuthor">Rogaway, P.</span> and <span class="refAuthor">T. Shrimpton</span>, <span class="refTitle">"A provable-security treatment of the key-wrap problem"</span>, <time datetime="2006" class="refDate">2006</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Arne Schwabe</span></div>
<div dir="auto" class="left"><span class="org">OpenVPN, Inc</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:david.sommerseth@openvpn.net" class="email">david.sommerseth@openvpn.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Sommerseth</span></div>
<div dir="auto" class="left"><span class="org">OpenVPN, Inc</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:david.sommerseth@openvpn.net" class="email">david.sommerseth@openvpn.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steffan Karger</span></div>
<div dir="auto" class="left"><span class="org">Fox-IT</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:steffan.karger@fox-it.com" class="email">steffan.karger@fox-it.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
